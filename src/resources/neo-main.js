(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=jQuery;var n=t.n(e);const i=Garnish;var o=t.n(i);const s=Craft;var a=t.n(s);const l={_stack:[[]],enter(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"==typeof t&&(t=this.fromFieldName(t)),e){const e=this.getNamespace();e.push(...t),t=e}this._stack.push(t)},enterByFieldName(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.enter(this.fromFieldName(t),e)},leave(){return this._stack.length>1?this._stack.pop():this.getNamespace()},getNamespace(){return Array.from(this._stack[this._stack.length-1])},parse(t){return"string"==typeof t?t.indexOf("[")>-1?this.fromFieldName(t):t.indexOf("-")>-1?t.split("-"):t.indexOf(".")>-1?t.split("."):t:Array.from(t)},value(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";const n=this.getNamespace();return n.push(t),n.join(e)},fieldName(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const e=this.toFieldName();return e?e+t.replace(/([^'"[\]]+)([^'"]*)/,"[$1]$2"):t},toString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-";return this.getNamespace().join(t)},toFieldName(){const t=this.getNamespace();switch(t.length){case 0:return"";case 1:return t[0]}return t[0]+"["+t.slice(1).join("][")+"]"},fromFieldName:t=>t.match(/[^[\]\s]+/g)||[]},c=o().Drag.extend({$container:null,blocks:null,maxTopBlocks:0,_draggeeBlocks:null,init(t,e){void 0===e&&n().isPlainObject(t)&&(e=t,t=null),(e=n().extend({},c.defaults,e)).axis=o().Y_AXIS,this.base(t,e),this.$container=e.container,this.blocks=[],this.maxTopBlocks=e.maxTopBlocks},getHelperTargetX(){return this.$draggee.offset().left},getHelperTargetY(){const t=this.settings.magnetStrength;if(1!==t){const e=this.$draggee.offset().top;return e+(this.mouseY-this.mouseOffsetY-e)/t}return this.base()},getBlockByElement(t){return this.blocks.find((e=>e.$container.is(t)))},getParentBlock(t){const e=t.$container.parent().closest(".ni_block");return e.length>0&&this.getBlockByElement(e)},onDragStart(){const t=this;this._draggeeBlocks=[],this.$draggee.each((function(){t._draggeeBlocks.push(t.getBlockByElement(this))})),this.base(),this._calculateMidpoints()},onDrag(){const t=this._getClosestMidpoint();t&&this._moveDraggeeToBlock(t.block,t.type,t.direction),this.base()},onDragStop(){const t=this;this.$draggee.each((function(){const e=n()(this),i=t.getBlockByElement(e);if(e.parent().is(t.$container))i.setLevel(1);else{const e=t.getParentBlock(i);i.setLevel(e.getLevel()+1)}e.find(".ni_block").each((function(){const e=n()(this),i=t.getBlockByElement(e),o=t.getParentBlock(i);i.setLevel(o.getLevel()+1)}))})),this.returnHelpersToDraggees(),this.base()},addBlock(t){this.blocks.push(t),this.addItems(t.$container)},removeBlock(t){this.blocks=this.blocks.filter((e=>e!==t)),this.removeItems(t.$container)},_getClosestMidpoint(){let t=Number.MAX_VALUE,e=Number.MIN_VALUE,n=null;for(const i of this._currentMidpoints)if(i.direction===c.DIRECTION_UP){this.mouseY-this.mouseOffsetY<i.position&&i.position<t&&(t=i.position,n=i)}else{this.mouseY-this.mouseOffsetY+this._draggeeBlockHeight>i.position&&i.position>e&&(e=i.position,n=i)}return n},_calculateMidpoints(){this._draggeeBlockY=this.$draggee.offset().top,this._draggeeBlockHeight=this.$draggee.height()+10,this._currentMidpoints=[];for(const t of this.blocks)if(0===t.$container.closest(this.$draggee).length){const e=this._getBlockMidpoints(t);for(const n of Object.keys(e)){const i=e[n],o=this._draggeeBlockY>i?c.DIRECTION_UP:c.DIRECTION_DOWN;this._currentMidpoints.push({block:t,position:i,type:n,direction:o})}}const t=this.$container.offset().top+this.$container.height()+5;this._currentMidpoints.push({block:null,position:t,type:c.TYPE_END,direction:c.DIRECTION_DOWN})},_getBlockMidpoints(t){const e={};if(!(t.$container.parent().closest(".ni_block.is-collapsed").length>0)){const n=t.$container.offset().top,i=t.isExpanded(),o=t.$container.height(),s=t.$topbarContainer.height(),a=i?t.$childrenContainer.height():0,l=i&&t.$contentContainer.length>0?t.$childrenContainer.length>0?t.$childrenContainer.offset().top-t.$contentContainer.offset().top:t.$contentContainer.height():0,r=this.getParentBlock(t);if(r&&!this._validateDraggeeChildren(r)||(e[c.TYPE_CONTENT]=n+(s+l)/2),a>0&&t.isExpanded()&&this._validateDraggeeChildren(t)){const i=t.getButtons().$container.height();e[c.TYPE_CHILDREN]=n+o-1-(14+i+10)/2}}return e},_moveDraggeeToBlock:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.TYPE_CONTENT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.DIRECTION_DOWN;const i=t?this.getParentBlock(t):null,o=this._validateDraggeeChildren(i);switch(e){case c.TYPE_CHILDREN:0===this.$draggee.closest(t.$container).length?t.$blocksContainer.append(this.$draggee):o&&t.$container.after(this.$draggee);break;case c.TYPE_END:o&&this.$container.append(this.$draggee);break;default:n===c.DIRECTION_UP?o&&t.$container.before(this.$draggee):t.getBlockType().isParent()&&t.isExpanded()&&this._validateDraggeeChildren(t)?t.$blocksContainer.prepend(this.$draggee):o&&t.$container.after(this.$draggee)}this._updateHelperAppearance(),this._calculateMidpoints()},_validateDraggeeChildren(t){const e=t?t.getField():this._draggeeBlocks[0].getField(),n=e.getMaxLevels();if(n>0){const i=t?t.getLevel():-1,o=this._draggeeBlocks[0].getLevel(),s=t=>t.getLevel()-o+i+1>=n,a=t=>{const n=t.getChildren(e.getBlocks(),!0);return s(t)||n.some(a)};if(this._draggeeBlocks.filter(a).length>0)return!1}if(!t){const t=this,e=this.$container.children(".ni_block:not(.is-disabled)");let n=e.length;for(const t of this._draggeeBlocks)if(!t.getBlockType().getTopLevel())return!1;return e.each((function(){t._draggeeBlocks.includes(t.getBlockByElement(this))&&n--})),!(this.maxTopBlocks>0&&n>=this.maxTopBlocks)}const i=t.getBlockType(),o=i.getMaxChildBlocks(),s=t.$childrenContainer.children(".ni_blocks").children(".ni_block");let a=s.length;const l=[],c=this;if(s.each((function(){const t=c.getBlockByElement(this);c._draggeeBlocks.includes(t)?a--:l.push(t)})),o>0&&a>=o)return!1;const r=[];for(const t of this._draggeeBlocks){if(!i.isValidChildBlock(t))return!1;if(r.includes(t))continue;const e=t.getBlockType(),n=e.getMaxSiblingBlocks();if(0===n)continue;const o=this._draggeeBlocks.filter((t=>t.getBlockType().getHandle()===e.getHandle()));if(l.filter((t=>t.getBlockType().getHandle()===e.getHandle())).length+o.length>n)return!1;r.push(...o)}return!0},_updateHelperAppearance(){for(const t of this.helpers){const e=t.data("neo-b-id"),n=this.blocks.find((t=>t.$container.data("neo-b-id")===e));t.css({width:n.$container.width()+1,height:n.$container.height()})}}},{TYPE_CONTENT:"content",TYPE_CHILDREN:"children",TYPE_END:"end",DIRECTION_UP:"up",DIRECTION_DOWN:"down",defaults:{container:null,magnetStrength:1}}),r=c,d={name:"",errors:[]},h=o().Base.extend({init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},d,t),this._name=t.name,this._errors=t.errors},getErrors(){return Array.from(this._errors)},getName(){return this._name}}),u={id:-1,fieldLayoutId:-1,sortOrder:0,name:"",handle:"",maxBlocks:0,maxSiblingBlocks:0,maxChildBlocks:0,childBlocks:!1,topLevel:!0,tabs:[],hasChildBlocksUiElement:!1},p=o().Base.extend({init(){var t,e,n,i;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o=Object.assign({},u,o),this._id=0|o.id,this._fieldLayoutId=0|o.fieldLayoutId,this._sortOrder=0|o.sortOrder,this._name=o.name,this._handle=o.handle,this._description=o.description,this._icon=o.icon,this._maxBlocks=0|o.maxBlocks,this._maxSiblingBlocks=0|o.maxSiblingBlocks,this._maxChildBlocks=0|o.maxChildBlocks,this._childBlocks=o.childBlocks,this._topLevel=o.topLevel,this._tabs=null!==(t=null===(e=o.tabs.tabNames)||void 0===e?void 0:e.map((t=>t instanceof h?t:new h({name:t}))))&&void 0!==t?t:[],this._html=null!==(n=o.tabs.html)&&void 0!==n?n:"",this._js=null!==(i=o.tabs.js)&&void 0!==i?i:"",this._hasChildBlocksUiElement=o.hasChildBlocksUiElement},getType:()=>"blockType",getId(){return this._id},getFieldLayoutId(){return this._fieldLayoutId},getSortOrder(){return this._sortOrder},getName(){return this._name},getHandle(){return this._handle},getDescription(){return this._description},getIcon(){return this._icon},getMaxBlocks(){return this._maxBlocks},getMaxSiblingBlocks(){return this._maxSiblingBlocks},getMaxChildBlocks(){return this._maxChildBlocks},getChildBlocks(){return this._childBlocks},getTopLevel(){return this._topLevel},getTabs(){return Array.from(this._tabs)},getHtml(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._replaceBlockIdPlaceholder(this._html,t)},getJs(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._replaceBlockIdPlaceholder(this._js,t)},_replaceBlockIdPlaceholder(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==e?t.replace(/__NEOBLOCK__/g,e):t},getChildBlockItems(t){const e=t.filter((t=>"group"===t.getType()||this.hasChildBlock(t.getHandle())));return e.filter(((t,n)=>{if("group"===t.getType()){const t=e[n+1];return t&&"group"!==t.getType()}return!0}))},isParent(){const t=this.getChildBlocks();return!0===t||"*"===t||Array.isArray(t)&&t.length>0},hasChildBlock(t){const e=this.getChildBlocks();return!0===e||"*"===e||Array.isArray(e)&&e.includes(t)},isValidChildBlock(t){return this.hasChildBlock(t.getBlockType().getHandle())},hasChildBlocksUiElement(){return this._hasChildBlocksUiElement}}),g={id:-1,sortOrder:0,alwaysShowDropdown:null,name:""},b=o().Base.extend({init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},g,t),this._id=0|t.id,this._sortOrder=0|t.sortOrder,this._alwaysShowDropdown=t.alwaysShowDropdown,this._name=t.name},getType:()=>"group",getId(){return this._id},getSortOrder(){return this._sortOrder},getName(){return this._name},getAlwaysShowDropdown(){return this._alwaysShowDropdown},isBlank(){return!this._name}});n().fn.insertAt=function(t,e){return this.each((function(){0===t?e.prepend(this):e.children().eq(t-1).after(this)}))};const k={namespace:[],blockType:null,id:null,level:1,buttons:null,enabled:!0,collapsed:!1,modified:!0,showButtons:!0},_={},f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function m(){let t=this.href||this.src;if(t){const e=t.indexOf("?");t=e<0?t:t.substr(0,e);const n=!Object.prototype.hasOwnProperty.call(_,t);return _[t]=1,n}return!0}function v(t){return t?t.replace(/[&<>"'/]/g,(t=>f[t])):""}function B(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;return(t=t||"").length>e?t.slice(0,e-3)+"...":t}const y=o().Base.extend({_templateNs:[],_field:null,_blockType:null,_initialised:!1,_expanded:!0,_enabled:!0,_modified:!0,_initialState:null,_forceModified:!1,init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=Object.assign({},k,t),this._templateNs=l.parse(t.namespace),this._field=t.field,this._blockType=t.blockType,this._id=t.id,this._buttons=t.buttons,this._initialEnabled=t.enabled,this._modified=t.modified,this._showButtons=t.showButtons,this._renderOldChildBlocksContainer=!t.blockType.hasChildBlocksUiElement(),this.$container=e?this._generateElement():n()("[data-neo-b-id=".concat(this._id,"]"));const i=this.$container.find("[data-neo-b]");this.$bodyContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.body"]')),this.$contentContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.content"]')),this.$childrenContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.children"]')),this.$childrenWarningsContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.childrenWarnings"]')),this.$collapsedChildrenContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.collapsedChildren"]')),this.$blocksContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.blocks"]')),this.$buttonsContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.buttons"]')),this.$topbarContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.topbar"]')),this.$topbarLeftContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.topbarLeft"]')),this.$topbarRightContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.topbarRight"]')),this.$tabsContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.tabs"]')),this.$tabContainer=this.$contentContainer.children("[data-layout-tab]"),this.$menuContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.menu"]')),this.$previewContainer=i.filter('[data-neo-b="'.concat(this._id,'.container.preview"]')),this.$tabButton=i.filter('[data-neo-b="'.concat(this._id,'.button.tab"]')),this.$settingsButton=i.filter('[data-neo-b="'.concat(this._id,'.button.actions"]')),this.$togglerButton=i.filter('[data-neo-b="'.concat(this._id,'.button.toggler"]')),this.$tabsButton=i.filter('[data-neo-b="'.concat(this._id,'.button.tabs"]')),this.$enabledInput=i.filter('[data-neo-b="'.concat(this._id,'.input.enabled"]')),this.$levelInput=i.filter('[data-neo-b="'.concat(this._id,'.input.level"]')),this.$status=i.filter('[data-neo-b="'.concat(this._id,'.status"]')),this.$sortOrder=i.filter('[data-neo-b="'.concat(this._id,'.sortOrder"]')),this.$form=this.$container.closest("form"),this._buttons&&(this._buttons.on("newBlock",(t=>this.trigger("newBlock",Object.assign(t,{level:this.getLevel()+1})))),this.$buttonsContainer.append(this._buttons.$container));let o=!1;if(this._blockType)for(const t of this._blockType.getTabs()){const e='[data-neo-b-info="'.concat(t.getName(),'"]');this.$tabContainer.filter(e).find("ul.errors").length>0&&(o=!0,this.$tabButton.filter(e).addClass("error"))}this.setLevel(t.level),this.toggleExpansion(!!o||!t.collapsed,!1,!1),this.toggleShowButtons(this._showButtons),this.addListener(this.$topbarContainer,"dblclick","@doubleClickTitle")},_generateElement(){l.enter(this._templateNs);const t=l.toFieldName();l.leave();const e=this._blockType,i=e.getTabs(),o=i.length>0,s=e.isParent(),c="".concat(e.getName()," ").concat(a().t("neo","Actions")),r="neoblock-action-menu-".concat(this._id),d="".concat(e.getName()," ").concat(a().t("neo","Tabs")),h="neoblock-tabs-menu-".concat(this._id),u=[];if(u.push('\n      <div class="ni_block ni_block--'.concat(e.getHandle()," is-").concat(this._collapsed?"collapsed":"expanded"," ").concat(o||s?"":"is-empty"," ").concat(s?"is-parent":"",'" data-neo-b-id="').concat(this._id,'  data-neo-b-name="').concat(e.getName(),'">\n        <input type="hidden" name="').concat(t,'[type]" value="').concat(e.getHandle(),'">\n        <input type="hidden" name="').concat(t,'[enabled]" value="').concat(this._enabled?"1":"",'" data-neo-b="').concat(this._id,'.input.enabled">\n        <input type="hidden" name="').concat(t,'[level]" value="').concat(this._level,'" data-neo-b="').concat(this._id,'.input.level">\n        <input type="hidden" name="').concat(this._templateNs[0],"[").concat(this._templateNs[1],'][sortOrder][]" value="').concat(this._id,'" data-neo-b="').concat(this._id,'.input.sortOrder">\n\n        <div class="ni_block_topbar" data-neo-b="').concat(this._id,'.container.topbar">\n          <div class="ni_block_topbar_left" data-neo-b="').concat(this._id,'.container.topbarLeft">\n            <div class="ni_block_topbar_item" data-neo-b="').concat(this._id,'.select">\n              <div class="checkbox block-checkbox" title="').concat(a().t("neo","Select"),' aria-label="').concat(a().t("neo","Select"),'"></div>\n            </div>\n            <div class="ni_block_topbar_item title clip-text">\n              <span class="blocktype" data-neo-b="').concat(this._id,'.select">').concat(e.getName(),'</span><span class="preview" data-neo-b="').concat(this._id,'.container.preview">&nbsp;</span>\n            </div>\n          </div>\n          <div class="ni_block_topbar_right" data-neo-b="').concat(this._id,'.container.topbarRight">\n            <div class="ni_block_topbar_item size-full tabs">')),(o||s)&&u.push('\n              <div class="tabs_trigger" data-neo-b="'.concat(this._id,'.button.toggler"></div>')),i.length>1){u.push('\n              <div class="tabs_inner" data-neo-b="'.concat(this._id,'.container.tabs">'));for(let t=0;t<i.length;t++){const e=i[t].getName();u.push('\n                <a class="tab '.concat(t?"":"is-selected",'" data-neo-b="').concat(this._id,'.button.tab" data-neo-b-info="').concat(e,'">').concat(e,"</a>"))}u.push('\n              </div>\n              <div>\n                <button type="button" role="button" title='.concat(a().t("neo","Tabs"),' aria-controls="').concat(h,'" aria-label="').concat(d,'" data-disclosure-trigger data-neo-b="').concat(this._id,'.button.tabs" class="tabs_btn menubtn">\n                  ').concat(i[0].getName(),'\n                </button>\n                <div id="').concat(h,'" class="neo_block_tabs-menu menu menu--disclosure">\n                  <ul>'));for(let t=0;t<i.length;t++){const e=i[t].getName();u.push("\n                    <li>\n                      <a".concat(t?"":' class="is-selected"',' href="#" type="button" role="button" aria-label="').concat(e,'" data-neo-b="').concat(this._id,'.button.tab" data-neo-b-info="').concat(e,'">').concat(e,"</a>\n                    </li>"))}u.push("\n                  </ul>\n                </div>\n              </div>")}return u.push('\n            </div>\n            <div class="ni_block_topbar_item hidden" data-neo-b="'.concat(this._id,'.status">\n              <div class="status off" title="').concat(a().t("neo","Disabled"),'"></div>\n            </div>\n            <div class="ni_block_topbar_item block-settings">\n              <div>\n                <button class="btn settings icon menubtn" type="button" role="button" title="').concat(a().t("neo","Actions"),'" aria-controls="').concat(r,'" aria-label="').concat(c,'" data-disclosure-trigger data-neo-b="').concat(this._id,'.button.actions"></button>\n                <div id="').concat(r,'" class="menu menu--disclosure" data-neo-b="').concat(this._id,'.container.menu">\n                  <ul class="padded">')),(o||s)&&u.push('\n                    <li><a data-icon="collapse" data-action="collapse" href="#" type="button" role="button" aria-label="'.concat(a().t("neo","Collapse"),'">').concat(a().t("neo","Collapse"),'</a></li>\n                    <li class="hidden"><a data-icon="expand" data-action="expand" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Expand"),'">').concat(a().t("neo","Expand"),"</a></li>")),u.push('\n                    <li><a data-icon="disabled" data-action="disable" href="#" type="button" role="button" aria-label="'.concat(a().t("neo","Disable"),'">').concat(a().t("neo","Disable"),'</a></li>\n                    <li class="hidden"><a data-icon="enabled" data-action="enable" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Enable"),'">').concat(a().t("neo","Enable"),'</a></li>\n                    <li class="hidden"><a data-icon="uarr" data-action="moveUp" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Move up"),'">').concat(a().t("neo","Move up"),'</a></li>\n                    <li class="hidden"><a data-icon="darr" data-action="moveDown" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Move down"),'">').concat(a().t("neo","Move down"),'</a></li>\n                  </ul>\n                  <hr>\n                  <ul class="padded">\n                    <li><a data-icon="plus" data-action="add" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Add block above"),'">').concat(a().t("neo","Add block above"),'</a></li>\n                    <li><a data-icon="field" data-action="copy" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Copy"),'">').concat(a().t("neo","Copy"),'</a></li>\n                    <li><a data-icon="brush" data-action="paste" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Paste"),'">').concat(a().t("neo","Paste"),'</a></li>\n                    <li><a data-icon="share" data-action="duplicate" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Clone"),'">').concat(a().t("neo","Clone"),'</a></li>\n                  </ul>\n                  <hr>\n                  <ul class="padded">\n                    <li><a class="error" data-icon="remove" data-action="delete" href="#" type="button" role="button" aria-label="').concat(a().t("neo","Delete"),'">').concat(a().t("neo","Delete"),'</a></li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n            <div class="ni_block_topbar_item block-reorder">\n              <a class="move icon" title="').concat(a().t("neo","Reorder"),'" aria-label="').concat(a().t("neo","Reorder"),'" role="button" data-neo-b="').concat(this._id,'.button.move"></a>\n            </div>\n          </div>\n        </div>')),(o||s)&&(u.push('\n        <div class="ni_block_body" data-neo-b="'.concat(this._id,'.container.body">')),o&&u.push('\n          <div class="ni_block_content" data-neo-b="'.concat(this._id,'.container.content">\n            ').concat(e.getHtml(this._id),"\n          </div>")),s&&this._renderOldChildBlocksContainer&&u.push('\n          <div class="ni_block_children" data-neo-b="'.concat(this._id,'.container.children">\n            <div class="ni_blocks" data-neo-b="').concat(this._id,'.container.blocks">\n            </div>\n            <div data-neo-b="').concat(this._id,'.container.buttons" class="hidden"></div>\n            <div data-neo-b="').concat(this._id,'.container.childrenWarnings" class="hidden">\n              <p class="first warning with-icon">').concat(a().t("neo","This Neo field's maximum number of levels has been reached, so no child blocks can be added here."),"</p>\n            </div>\n          </div>")),u.push("\n        </div>")),s&&u.push('\n        <div class="ni_block_collapsed-children" data-neo-b="'.concat(this._id,'.container.collapsedChildren"></div>')),u.push('\n      <div data-neo="container.buttons"></div>'),n()(u.join(""))},initUi(){var t;let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this._initialised){if(this.$foot=n()(this._blockType.getJs(this._id)).filter(m),o().$bod.append(this.$foot),e&&a().initUiElements(this.$contentContainer),this._tabsMenu=this.$tabsButton.data("trigger")||new(o().DisclosureMenu)(this.$tabsButton),this._tabsMenu.on("show",(()=>this.$container.addClass("active"))),this._tabsMenu.on("hide",(()=>this.$container.removeClass("active"))),this.$tabButton=this.$tabButton.add(this._tabsMenu.$container.find('[data-neo-b="'.concat(this._id,'.button.tab"]'))),this.addListener(this.$tabButton,"click",this["@setTab"]),this.addListener(this.$tabButton,"keydown",this._handleTabKeydown),this._settingsMenu=this.$settingsButton.data("trigger")||new(o().DisclosureMenu)(this.$settingsButton),this._settingsMenu.on("show",(()=>this.$container.addClass("active"))),this._settingsMenu.on("hide",(()=>this.$container.removeClass("active"))),this.$menuContainer=this._settingsMenu.$container,this.addListener(this.$menuContainer.find("[data-action]"),"click",this._handleActionClick),this.addListener(this.$menuContainer.find("[data-action]"),"keydown",this._handleActionKeydown),this.toggleEnabled(this._initialEnabled),this._initialised=!0,null===(t=this._buttons)||void 0===t||t.initUi(),o().requestAnimationFrame((()=>this.updateResponsiveness())),this.$container.on("mousedown",".matrixblock",(function(t){n()(this).addClass("neo-matrixblock")})),!this.isNew()){this._initialState={enabled:this._enabled,level:this._level,content:o().getPostData(this.$contentContainer)};const t=()=>this._detectChange(),e=new window.MutationObserver((()=>setTimeout(t,200)));if(e.observe(this.$container[0],{attributes:!0,childList:!0,characterData:!0,subtree:!0}),this.$contentContainer.on("propertychange change click","input, textarea, select, div.redactor-in",t),this.$contentContainer.on("paste input keyup",'input:not([type="hidden"]), textarea, div.redactor-in',t),this._detectChangeObserver=e,this.$contentContainer.length>0&&this.$contentContainer.html().match(/\[blocks\]\[new/)){this._forceModified=!0,this.setModified(!0);const t=this._templateNs[0]+"["+this._templateNs[1]+"]";a().modifiedDeltaNames.includes(t)||a().modifiedDeltaNames.push(t)}}this.$contentContainer,a().CpFieldInspectPlugin&&a().CpFieldInspectPlugin.addFieldLinks(),this.trigger("initUi")}},destroy(){this._initialised&&(this.$foot.remove(),clearInterval(this._detectChangeInterval),this._detectChangeObserver&&this._detectChangeObserver.disconnect(),this.trigger("destroy"))},getBlockType(){return this._blockType},getId(){return this._id},isTopLevel(){return 1===this._level},getLevel(){return this._level},setLevel(t){this._level=0|t,this.$levelInput.val("0".concat(this._level)),this.$container.toggleClass("is-level-odd",!!(this._level%2)),this.$container.toggleClass("is-level-even",!(this._level%2))},setModified(t){this._modified=t},getButtons(){return this._buttons},getSiteId(){if(!this._siteId){const t=this.$form.find('input[name="siteId"]');this._siteId=t.val()}return this._siteId},getContent(){const t=o().getPostData(this.$contentContainer),e={},i=(t,i)=>{let o=e;for(let e=0;e<t.length-1;e++){const i=t[e];n().isPlainObject(o[i])||n().isArray(o[i])||(o[i]={}),o=o[i]}o[t[t.length-1]]=i};for(const e of Object.keys(t)){const n=l.parse(e).slice(this._templateNs.length+1);if(!n.length)continue;i(n,t[e])}return e},getParent(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==(t=e)&&void 0!==t||(e=this._field.getBlocks());const n=this.getLevel();let i=e.indexOf(this),o=null;if(i>=0&&n>1)for(;null===o&&i>0;){const t=e[--i];t.getLevel()===n-1&&(o=t)}return o},getChildren(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==(t=e)&&void 0!==t||(e=this._field.getBlocks());const i=this.getLevel();let o=e.indexOf(this);const s=[];if(o>=0){let t=e[++o];for(;t&&t.getLevel()>i;){const a=t.getLevel();(n?a>i:a===i+1)&&s.push(t),t=e[++o]}}return s},getSiblings(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!==(t=e)&&void 0!==t||(e=this._field.getBlocks()),this.isTopLevel()?e.filter((t=>t.isTopLevel())):this.getParent(e).getChildren(e)},getField(){return this._field},updatePreview(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t="boolean"==typeof t&&t;const e=this.$childrenContainer.find(".field"),i=this.$contentContainer.find(".field").add(e),s=[];i.each((function(){const e=n()(this),i=e.children(".input"),l=e.data("type"),c=e.children(".heading").children("label").text();if(null===l)return;let r=!1;switch(l){case"craft\\fields\\Assets":{const e=[],o=i.find(".element");o.each((function(){const i=n()(this),s=i.find(".elementthumb");let a=s.children("img").prop("srcset");if(a||(a=s.data("srcset")),e.push('<img sizes="30px" srcset="'.concat(a,'">')),!t&&1===o.length){const t=i.find(".title").text();e.push(v(B(t)))}})),r=e.join(" ")}break;case"craft\\fields\\Categories":case"craft\\fields\\Entries":case"craft\\fields\\Tags":case"craft\\fields\\Users":{const t=[];i.find(".element").each((function(){const e=n()(this).find(".title, .label").eq(0).text();t.push(v(B(e)))})),r=t.join(", ")}break;case"craft\\fields\\Checkboxes":{const t=[];i.find('input[type="checkbox"]').each((function(){if(this.checked){const e=n()(this).prop("id"),o=i.find('label[for="'.concat(e,'"]')).text();t.push(v(B(o)))}})),r=t.join(", ")}break;case"craft\\fields\\Color":{const t=i.find('input[type="color"]').val(),e=i.find('input[type="text"]').val(),n=i.find("div.colorhex").text();let o=null;o=t&&e?"background-color: ".concat(t):!t&&e?"background-color: ".concat(e):n?"background-color: ".concat(n):"background-image: repeating-linear-gradient(-45deg, transparent, transparent 2px, #777 2px, #777 3px)",r='<div class="preview_color" style="'.concat(o,'"></div>')}break;case"craft\\fields\\Date":{const t=v(i.find(".datewrapper input").val()),e=v(i.find(".timewrapper input").val());r=t&&e?t+" "+e:t||e}break;case"craft\\fields\\Dropdown":r=v(B(i.find("select").children(":selected").text()));break;case"craft\\fields\\Email":r=v(B(i.children('input[type="email"]').val()));break;case"craft\\fields\\Lightswitch":{const t=!!i.find("input").val();r='<span class="status'.concat(t?" live":"",'"></span>')+v(B(c))}break;case"craft\\fields\\MultiSelect":case"ttempleton\\categorygroupsfield\\fields\\CategoryGroupsField":{const t=[];i.find("select").children(":selected").each((function(){t.push(n()(this).text())})),r=v(B(t.join(", ")))}break;case"craft\\fields\\Number":case"craft\\fields\\PlainText":r=v(B(i.children('input[type="text"]').val()));break;case"craft\\fields\\RadioButtons":r=v(B(i.find('input[type="radio"]:checked').closest("label").text()));break;case"craft\\redactor\\Field":r=v(B(a().getText(i.find("textarea").val())));break;case"craft\\ckeditor\\Field":r=v(B(a().getText(i.find('[role="textbox"]').html())));break;case"craft\\fields\\Url":r=v(B(i.children('input[type="url"]').val()));break;case"craft\\fields\\Matrix":case"verbb\\supertable\\fields\\SuperTableField":{const t=e.find(".field").find('input[type!="hidden"], select, textarea, .label'),i=[];t.each((function(){const t=n()(this);let e=null;t.is("input, textarea")?e=a().getText(o().getInputPostVal(t)):t.is("select")?e=t.find("option:selected").text():t.hasClass("label")&&(e=t.text()),e&&i.push(B(e))})),r=v(i.join(", "))}break;case"typedlinkfield\\fields\\LinkField":case"fruitstudios\\linkit\\fields\\LinkitField":{const t=[],e=i.find("select").children(":selected").first(),n=i.find('.linkfield--typeOption:not(.hidden), [class^="linkit--"]:not(.hidden)'),o=n.find('input[type!="hidden"]').val(),s=n.find(".element"),a=i.find('.field[id*="customText"] input, .linkit--customText input').val();if(t.push(B(e.text())),o&&t.push(B(o)),s.length>0){const e=s.find(".title, .label").eq(0).text();t.push(B(e))}a&&t.push(B(a)),r=v(t.join(", "))}break;case"luwes\\codemirror\\fields\\CodeMirrorField":{const t=[];e.find(".CodeMirror-line > span").each((function(){t.push(n()(this).text())})),r=v(t.join(" "));break}case"rias\\positionfieldtype\\fields\\Position":r=v(i.find(".btn.active").prop("title"));break;case"wrav\\oembed\\fields\\OembedField":r=v(B(i.children("input").val()))}r&&s.length<10&&s.push('<span class="preview_section">',r,"</span>")})),this.$previewContainer.html(s.join(""))},isNew(){return/^new/.test(this.getId())},isSelected(){return this.$container.hasClass("is-selected")},collapse(t,e){this.toggleExpansion(!1,t,e)},expand(t,e){this.toggleExpansion(!0,t,e)},toggleExpansion(t,e,n){if(t="boolean"==typeof t?t:!this._expanded,e="boolean"!=typeof e||e,n=!o().prefersReducedMotion()&&("boolean"!=typeof n||n),t!==this._expanded){this._expanded=t;const i=this.$menuContainer.find('[data-action="expand"]').parent(),o=this.$menuContainer.find('[data-action="collapse"]').parent();this.$container.toggleClass("is-expanded",this._expanded).toggleClass("is-collapsed",!this._expanded),i.toggleClass("hidden",this._expanded),o.toggleClass("hidden",!this._expanded),this._expanded||this.updatePreview();const s={opacity:1,height:(0|this.$contentContainer.outerHeight())+(0|this.$childrenContainer.outerHeight())},a={opacity:0,height:0},l={opacity:"",height:""};n?this.$bodyContainer.css(this._expanded?a:s).velocity(this._expanded?s:a,"fast",(t=>{this._expanded&&this.$bodyContainer.css(l)})):this.$bodyContainer.css(this._expanded?l:a),e&&this.saveExpansion(),this.trigger("toggleExpansion",{expanded:this._expanded})}},isExpanded(){return this._expanded},saveExpansion(){if(!this.isNew()){var t;const e=this.getId(),n=this.$form.data("elementEditor"),i=null!==(t=null==n?void 0:n.duplicatedElements[e])&&void 0!==t?t:e,o=null!=n&&n.settings.isProvisionalDraft?i:e,s={expanded:this.isExpanded()?1:0,blockId:o,siteId:this.getSiteId()};a().queue.push((()=>new Promise(((t,e)=>{a().sendActionRequest("POST","neo/input/save-expansion",{data:s}).then(t).catch(e)}))))}},disable(){this.toggleEnabled(!1)},enable(){this.toggleEnabled(!0)},toggleEnabled(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._enabled;if(t!==this._enabled){this._enabled=t;const e=this.$menuContainer.find('[data-action="enable"]').parent(),n=this.$menuContainer.find('[data-action="disable"]').parent();this.$container.toggleClass("is-enabled",this._enabled).toggleClass("is-disabled",!this._enabled),this.$status.toggleClass("hidden",this._enabled),e.toggleClass("hidden",this._enabled),n.toggleClass("hidden",!this._enabled),this.$enabledInput.val(this._enabled?"1":""),this.trigger("toggleEnabled",{enabled:this._enabled})}},isEnabled(){return this._enabled},toggleShowButtons(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._showButtons;this.$buttonsContainer.toggleClass("hidden",!t),this.$childrenWarningsContainer.toggleClass("hidden",t)},selectTab(t){this.$tabButton.removeClass("is-selected"),this.$tabContainer.addClass("hidden");const e=this.$tabButton.filter('[data-neo-b-info="'.concat(t,'"]')).addClass("is-selected"),n=this.$tabContainer.eq(e.index()).removeClass("hidden");this.$tabsButton.text(t),a().ElementThumbLoader.retryAll(),this.trigger("selectTab",{tabName:t,$tabButton:e,$tabContainer:n})},updateResponsiveness(){var t,e;null!==(t=this._topbarLeftWidth)&&void 0!==t||(this._topbarLeftWidth=this.$topbarLeftContainer.width()-(this._expanded?0:this.$previewContainer.width())),null!==(e=this._topbarRightWidth)&&void 0!==e||(this._topbarRightWidth=this.$topbarRightContainer.width());const n=this.$topbarContainer.width()<this._topbarLeftWidth+this._topbarRightWidth;this.$tabsContainer.toggleClass("invisible",n),this.$tabsButton.toggleClass("invisible",!n)},updateActionsMenu(){var t,e;const n=this._field.getBlocks(),i=null===(t=this.getParent())||void 0===t?void 0:t.getBlockType();let o=null!==(e=null==i?void 0:i.getChildBlocks())&&void 0!==e?e:this._field.getBlockTypes(!0);!0===o||"*"===o?o=this._field.getBlockTypes(!1):Array.isArray(o)&&(o=o.map((t=>"string"==typeof t?this._field.getBlockTypeByHandle(t):t))),this.updateMenuStates(this._field.getName(),n,this._field.getMaxBlocks(),!0,o,1===this._level?this._field.getMaxTopBlocks():0)},updateMenuStates(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;i="boolean"!=typeof i||i;const a=this.getBlockType(),l=e.filter((t=>t.getBlockType().getHandle()===a.getHandle())),c=a.getMaxBlocks(),r=this.getSiblings(e),d=e.filter((t=>t.isTopLevel())).length,h=n>0&&e.length>=n,u=s>0&&d>=s,p=a.getMaxChildBlocks(),g=p>0&&this.getChildren(e).length>=p,b=h||u||g||!i,k=c>0&&l.length>=c;let _=b||k;const f=JSON.parse(window.localStorage.getItem("neo:copy")||"{}");let m=b||!f.blocks||!f.field||f.field!==t;const v=this.getParent(e);if(!m&&v){const t=v.getBlockType().getMaxChildBlocks();if(t>0){const n=v.getChildren(e).length,i=f.blocks.length;m||(m=n+i>t)}}if(!m||!_){const t=this.getBlockType().getMaxSiblingBlocks();if(t>0){const e=t=>Object.prototype.hasOwnProperty.call(t,"type")?t.type===this.getBlockType().getId():"function"==typeof t.getBlockType&&t.getBlockType().getHandle()===this.getBlockType().getHandle(),n=r.filter(e,this).length,i=f.blocks?f.blocks.filter(e,this).length:0;m||(m=n+i>t),_||(_=n>=t)}}if(!m){const t=e.reduce(((t,e)=>{const n=e.getBlockType(),i=n.getId(),o=t[i]||{blockType:n,count:0};return o.count++,t[i]=o,t}));for(const e of f.blocks){const n=t[e.type];if(n){const t=n.blockType,e=n.count,i=t.getMaxBlocks(),o=i>0&&e>=i;m||(m=o)}1===e.level&&(m||(m=!o.find((t=>t.getId()===e.type))))}}const B=r.indexOf(this),y=B<=0,C=[-1,r.length-1].includes(B);this.$menuContainer.find('[data-action="moveUp"]').parent().toggleClass("hidden",y),this.$menuContainer.find('[data-action="moveDown"]').parent().toggleClass("hidden",C),this.$menuContainer.find('[data-action="add"]').toggleClass("disabled",b),this.$menuContainer.find('[data-action="duplicate"]').toggleClass("disabled",_),this.$menuContainer.find('[data-action="paste"]').toggleClass("disabled",m)},_handleActionClick(t){t.preventDefault(),this["@settingSelect"](t)},_handleActionKeydown(t){t.keyCode===o().SPACE_KEY&&(t.preventDefault(),this["@settingSelect"](t))},_handleTabKeydown(t){t.keyCode===o().SPACE_KEY&&this["@setTab"](t)},_detectChange(){const t=this.$form.data("elementEditor");if(null!=t&&t.enableAutosave&&t.settings.draftId&&(this.setModified(!0),this._forceModified=!0),!this._forceModified){const t=this._initialState,e=o().getPostData(this.$contentContainer),n=!a().compare(e,t.content,!1)||t.enabled!==this._enabled||t.level!==this._level;n!==this._modified&&this.setModified(n)}this.trigger("change")},"@settingSelect"(t){this._settingsMenu.hide();const e=n()(t.target);if(!e.hasClass("disabled"))switch(e.attr("data-action")){case"collapse":this.collapse();break;case"expand":this.expand();break;case"disable":this.disable(),this.collapse();break;case"enable":this.enable(),this.expand();break;case"moveUp":this.trigger("moveUpBlock",{block:this});break;case"moveDown":this.trigger("moveDownBlock",{block:this});break;case"delete":this.trigger("removeBlock",{block:this});break;case"add":this.trigger("addBlockAbove",{block:this});break;case"copy":this.trigger("copyBlock",{block:this});break;case"paste":this.trigger("pasteBlock",{block:this});break;case"duplicate":this.trigger("duplicateBlock",{block:this})}},"@doubleClickTitle"(t){t.preventDefault();const e=n()(t.target).parent(),i=e.closest(this.$topbarLeftContainer).length>0,o=e.closest(this.$topbarRightContainer).length>0;var s,a;i||o||(null===(s=this.$form.data("elementEditor"))||void 0===s||s.pause(),this.toggleExpansion(),null===(a=this.$form.data("elementEditor"))||void 0===a||a.resume())},"@setTab"(t){t.preventDefault(),this._tabsMenu.hide();const e=n()(t.currentTarget).attr("data-neo-b-info");this.selectTab(e)}},{_totalNewBlocks:0,getNewId(){return"new".concat(this._totalNewBlocks++)}}),C={blockTypes:[],groups:[],items:null,maxBlocks:0,maxTopBlocks:0,blocks:null},$=o().Base.extend({_blockTypes:[],_groups:[],_maxBlocks:0,_maxTopBlocks:0,init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},C,t),t.items?(this._items=Array.from(t.items),this._blockTypes=this._items.filter((t=>"blockType"===t.getType())),this._groups=this._items.filter((t=>"group"===t.getType()))):(this._blockTypes=Array.from(t.blockTypes),this._groups=Array.from(t.groups),this._items=[...this._blockTypes,...this._groups].sort(((t,e)=>t.getSortOrder()-e.getSortOrder()))),this._maxBlocks=0|t.maxBlocks,this._maxTopBlocks=0|t.maxTopBlocks,this.$container=this._generateButtons();const e=this.$container.find("[data-neo-bn]");this.$buttonsContainer=e.filter('[data-neo-bn="container.buttons"]'),this.$menuContainer=e.filter('[data-neo-bn="container.menu"]'),this.$blockButtons=e.filter('[data-neo-bn="button.addBlock"]'),this.$groupButtons=e.filter('[data-neo-bn="button.group"]'),t.blocks&&this.updateButtonStates(t.blocks),this.addListener(this.$blockButtons,"activate","@newBlock")},_generateButtons(){const t=[];let e=[],i=null,o=!0;const s=()=>{t.push('\n          <div class="btn dashed'.concat(o?" add icon":"",' menubtn" data-neo-bn="button.group">\n            ').concat(i.getName(),'\n          </div>\n          <div class="menu">\n            <ul>').concat(e.join(""),"\n            </ul>\n          </div>")),o=!1,e=[]};t.push('\n      <div class="ni_buttons">\n        <div class="btngroup" data-neo-bn="container.buttons">');for(let n=0;n<this._items.length;n++){const a=this._items[n],l=a.getType();if("blockType"===l){const n=a.getIcon()?'<img src="'.concat(a.getIcon(),'" class="icon">'):"",s=a.getDescription()?' title="'.concat(a.getDescription(),'"'):"";null!==i?e.push('\n            <li>\n              <a type="button"'.concat(s,' data-neo-bn="button.addBlock" data-neo-bn-info="').concat(a.getHandle(),'" class="flex neo-add-block-btn">\n                ').concat(n,"\n                ").concat(a.getName(),"\n              </a>\n            </li>")):(t.push('\n          <div type="button" '.concat(s,' class="btn dashed flex neo-add-block-btn').concat(o?" add icon":"",'" data-neo-bn="button.addBlock" data-neo-bn-info="').concat(a.getHandle(),'">\n            ').concat(n,"\n            ").concat(a.getName(),"\n          </div>")),o=!1)}else"group"===l&&(null!==i&&e.length>0&&s(),i=a.isBlank()||!a.getAlwaysShowDropdown()&&(n+2>=this._items.length||"group"===this._items[n+2].getType())?null:a)}null!==i&&e.length>0&&s(),t.push('\n        </div>\n        <div class="btn dashed add icon menubtn hidden" data-neo-bn="container.menu">\n          '.concat(a().t("neo","Add a block"),"\n        </div>")),i=null;let l=!1;t.push('\n        <div class="menu">\n          <ul>');for(const e of this._items){const n=e.getType();if("blockType"===n){null===i||l||(l=!0,t.push("\n              <h6>".concat(i.getName(),'</h6>\n              <ul class="padded">')));const n=e.getDescription()?' title="'.concat(e.getDescription(),'"'):"";t.push('\n            <li>\n              <button type="button" '.concat(n,' aria-label="').concat(e.getName(),'" data-neo-bn="button.addBlock" data-neo-bn-info="').concat(e.getHandle(),'">\n                ').concat(e.getName(),"\n              </button>\n            </li>"))}else"group"===n&&((null===i||l)&&t.push("\n              </ul>"),l=!1,i=e.isBlank()?null:e,null===i&&t.push("\n              <ul>"))}return t.push("\n          </ul>\n        </div>\n      </div>"),n()(t.join(""))},initUi(){n()(".menubtn",this.$container).menubtn(),this.updateResponsiveness()},getBlockTypes(){return Array.from(this._blockTypes)},getGroups(){return Array.from(this._groups)},getMaxBlocks(){return this._maxBlocks},updateButtonStates(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e="boolean"!=typeof e||e;const o=this,s=t.filter((t=>t.isTopLevel())).length,a=this._maxBlocks>0&&t.length>=this._maxBlocks,l=this._maxTopBlocks>0&&s>=this._maxTopBlocks,c=a||l||!e;this.$blockButtons.each((function(){const e=n()(this);let s=c;if(!s){const n=t=>t.getBlockType().getHandle()===a.getHandle(),a=o.getBlockTypeByButton(e),l=t.filter(n),c=a.getMaxBlocks(),r=a.getMaxSiblingBlocks(),d=null!==i?i.getChildren(t).filter(n):t.filter((t=>t.isTopLevel()&&t.getBlockType().getHandle()===a.getHandle()));s||(s=c>0&&l.length>=c||r>0&&d.length>=r)}e.toggleClass("disabled",s)})),this.$groupButtons.each((function(){const t=n()(this),e=t.data("menubtn");let i=c;if(!i&&e){const t=e.menu.$options;i=t.length===t.filter(".disabled").length}t.toggleClass("disabled",i)}))},updateResponsiveness(){var t;null!==(t=this._buttonsContainerWidth)&&void 0!==t||(this._buttonsContainerWidth=this.$buttonsContainer.width());const e=this.$container.width()<this._buttonsContainerWidth;this.$buttonsContainer.toggleClass("hidden",e),this.$menuContainer.toggleClass("hidden",!e)},getBlockTypeByButton(t){const e=t.attr("data-neo-bn-info");return this._blockTypes.find((t=>t.getHandle()===e))},"@newBlock"(t){const e=n()(t.currentTarget).attr("data-neo-bn-info"),i=this._blockTypes.find((t=>t.getHandle()===e));this.trigger("newBlock",{blockType:i})}}),x={name:null,namespace:[],blockTypes:[],groups:[],blocks:[],inputId:null,maxBlocks:0,maxTopBlocks:0,maxLevels:0},T=o().Base.extend({_templateNs:[],_name:null,_siteId:null,init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},x,t),this._templateNs=l.parse(t.namespace),this._blockTypes=[],this._groups=t.groups.map((t=>new b(t))),this._blocks=[],this._name=t.name,this._maxBlocks=t.maxBlocks,this._maxTopBlocks=t.maxTopBlocks,this._maxLevels=t.maxLevels,this._ownerId=null;const e=n()('[name="setId"], [name="entryId"], [name="categoryId"]');e.length&&(this._ownerId=e.val()),this.$container=n()("#"+t.inputId);const i={};this._groups.forEach((t=>{i[t.getId()]=!0}));const s={};for(const e of t.blockTypes)if(null===e.groupId||void 0!==i[e.groupId]){const t=new p(e);this._blockTypes.push(t),s[t.getHandle()]=t}this.$form=this.$container.closest("form"),this._siteId=this.$form.find('input[name="siteId"]').val();const a=this.$container.find("[data-neo]");this.$blocksContainer=a.filter('[data-neo="container.blocks"]'),this.$buttonsContainer=a.filter('[data-neo="container.buttons"]'),this._buttons=new $({blockTypes:this.getBlockTypes(!0),groups:this.getGroups(),maxBlocks:this.getMaxBlocks(),maxTopBlocks:this.getMaxTopBlocks()}),this.$buttonsContainer.append(this._buttons.$container),this._buttons.on("newBlock",(t=>this["@newBlock"](t))),this._buttons.initUi(),this._blockSort=new r({container:this.$blocksContainer,handle:'[data-neo-b$=".button.move"]',maxTopBlocks:this.getMaxTopBlocks(),filter:()=>this._blockSort.$targetItem.hasClass("is-selected")?this._blockSelect.getSelectedItems():this._blockSort.$targetItem,collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9,onDragStop:()=>{this._updateBlockOrder(),this._updateButtons()}}),this._blockSelect=new(o().Select)(this.$blocksContainer,null,{multi:!0,vertical:!0,handle:'> .ni_block_topbar [data-neo-b$=".select"]',checkboxMode:!0,selectedClass:"is-selected sel"}),this.$blocksContainer.find(".ni_block").each(((t,e)=>{const i=n()(e),o={};o.id=i.attr("data-neo-b-id"),o.sortOrder=t,o.collapsed=i.hasClass("is-collapsed"),o.enabled=!!i.find('[data-neo-b="'.concat(o.id,'.input.enabled"]')).val(),o.level=parseInt(i.find('[data-neo-b="'.concat(o.id,'.input.level"]')).val()),o.field=this,o.namespace=[...this._templateNs,o.id];const a=i.find('[data-neo-b="'.concat(o.id,'.input.type"]')).val(),l=s[a];o.blockType=new p({id:l.getId(),fieldLayoutId:l.getFieldLayoutId(),name:l.getName(),handle:l.getHandle(),description:l.getDescription(),icon:l.getIcon(),maxBlocks:l.getMaxBlocks(),maxSiblingBlocks:l.getMaxSiblingBlocks(),maxChildBlocks:l.getMaxChildBlocks(),childBlocks:l.getChildBlocks(),topLevel:l.getTopLevel(),hasChildBlocksUiElement:l.hasChildBlocksUiElement()}),o.buttons=new $({items:l.getChildBlockItems(this.getItems()),maxBlocks:this.getMaxBlocks()}),o.showButtons=!this.atMaxLevels(o.level);const c=new y(o);c.initUi(!1),this._setBlockEvents(c),this._blocks.push(c),this._blockSort.addBlock(c),this._blockSelect.addItems(c.$container)})),this._updateBlockOrder(),this._updateBlockChildren(),this._updateButtons(),this.addListener(document,"visibilitychange.input",(()=>this._updateButtons())),this.addListener(this.$container,"resize",(()=>this.updateResponsiveness()));const c="function"==typeof this.$form.data("serializer")?this.$form.data("serializer")():this.$form.serialize();this.$form.data("initialSerializedValue",c),this._setMatrixClassErrors(),this._setBlockTypeClassErrors(),this._blocks.filter((t=>!t.isExpanded())).forEach((t=>t.updatePreview())),this.trigger("afterInit")},getName(){return this._name},updateResponsiveness(){var t;for(const t of this._blocks){var e;t.updateResponsiveness(),null===(e=t.getButtons())||void 0===e||e.updateResponsiveness()}this._buttons.updateResponsiveness(),null===(t=this._tempButtons)||void 0===t||t.updateResponsiveness()},addBlock(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=this._blocks.length;e=e>=0?Math.max(0,Math.min(e,s)):s,i=!o().prefersReducedMotion()&&("boolean"!=typeof i||i);const a=e>0&&this._blocks[e-1],l=e<s&&this._blocks[e];if(a){const i=l?l.getLevel():1,o=a.getLevel()+(a.getBlockType().isParent()?1:0);n=Math.max(i,Math.min(n,o));const s=this._findPrevBlockOnLevel(e,n);s?s.$container.after(t.$container):a.$blocksContainer.prepend(t.$container)}else this.$blocksContainer.prepend(t.$container);t.setLevel(n),this._blocks.push(t),this._blockSort.addBlock(t),this._blockSelect.addItems(t.$container),t.initUi(),this._setBlockEvents(t),this._destroyTempButtons(),this._updateBlockOrder(),this._updateBlockChildren(),this._updateButtons(),i&&t.$container.css({opacity:0,marginBottom:-t.$container.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(e=>o().requestAnimationFrame((()=>o().scrollContainerToElement(t.$container))))),this.trigger("addBlock",{block:t,index:e})},removeBlock(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===(e=this.$form.data("elementEditor"))||void 0===e||e.pause(),n=!o().prefersReducedMotion()&&("boolean"!=typeof n||n),i="boolean"==typeof i&&i;const s=this._findChildBlocks(this._blocks.indexOf(t));for(const t of s)this.removeBlock(t,!0,!0);t.off(".input"),this._blocks=this._blocks.filter((e=>e!==t)),this._blockSort.removeItems(t.$container),this._blockSelect.removeItems(t.$container),this._destroyTempButtons(),this._updateButtons();const a=()=>{var e;t.$container.remove(),this._updateBlockChildren(),null===(e=this.$form.data("elementEditor"))||void 0===e||e.resume()};n?t.$container.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:i?10:-t.$container.outerHeight()},"fast",(t=>a())):a(),t.destroy(),this.trigger("removeBlock",{block:t})},_setBlockEvents(t){t.on("removeBlock.input",(e=>{this.getSelectedBlocks().length>1?window.confirm(a().t("neo","Are you sure you want to delete the selected blocks?"))&&this._blockBatch(t,(t=>this.removeBlock(t))):this.removeBlock(t)})),t.on("toggleEnabled.input",(e=>this._blockBatch(t,(t=>t.toggleEnabled(e.enabled))))),t.on("toggleExpansion.input",(e=>this._blockBatch(t,(t=>t.toggleExpansion(e.expanded))))),t.on("moveUpBlock.input",(e=>this._moveBlock(t,"up"))),t.on("moveDownBlock.input",(e=>this._moveBlock(t,"down"))),t.on("newBlock.input",(e=>this["@newBlock"](Object.assign(e,{index:this._getNextBlockIndex(t)})))),t.on("addBlockAbove.input",(t=>this["@addBlockAbove"](t))),t.on("copyBlock.input",(t=>this["@copyBlock"](t))),t.on("pasteBlock.input",(t=>this["@pasteBlock"](t))),t.on("duplicateBlock.input",(t=>this["@duplicateBlock"](t))),t.on("change.input",(()=>this.trigger("change",{block:t})))},_moveBlock(t,e){var n;let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!["up","down"].includes(e))return;null===(n=this.$form.data("elementEditor"))||void 0===n||n.pause();const s=t.getSiblings(this.getBlocks()),a=s.indexOf(t),l=a>0&&"up"===e,c=a<s.length-1&&"down"===e;if(-1===a||l===c)return;const r=!o().prefersReducedMotion()&&("boolean"!=typeof i||i),d=t.$container,h=()=>{d.detach(),l?s[a-1].$container.before(d):s[a+1].$container.after(d)},u=()=>{var t;this._updateBlockOrder(),this._updateButtons(),null===(t=this.$form.data("elementEditor"))||void 0===t||t.resume()};r?d.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:-d.outerHeight()},"fast",(t=>{h(),d.css({opacity:0,marginBottom:-d.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(t=>{u(),o().requestAnimationFrame((()=>o().scrollContainerToElement(d)))}))})):(h(),u())},getBlockByElement(t){return this._blocks.find((e=>e.$container.is(t)))},getBlocks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t>0?this._blocks.filter((e=>e.getLevel()===t)):Array.from(this._blocks)},getBlockTypeById(t){return this._blockTypes.find((e=>e.getId()===t))},getBlockTypeByHandle(t){return this._blockTypes.find((e=>e.getHandle()===t))},getBlockTypes(t){return(t="boolean"==typeof t&&t)?this._blockTypes.filter((t=>t.getTopLevel())):Array.from(this._blockTypes)},getGroups(){return Array.from(this._groups)},getItems(){return[...this.getBlockTypes(),...this.getGroups()].sort(((t,e)=>t.getSortOrder()-e.getSortOrder()))},getMaxBlocks(){return this._maxBlocks},getMaxTopBlocks(){return this._maxTopBlocks},getMaxLevels(){return this._maxLevels},atMaxLevels(t){return this._maxLevels>0&&t+1>this._maxLevels},getSelectedBlocks(){const t=this._blockSelect.getSelectedItems();return this._blocks.filter((e=>e.$container.closest(t).length>0))},_setMatrixClassErrors(){n()(".ni_block_body .matrix-field .input.errors").each((function(){const t=n()(this),e=t.closest(".ni_block_content_tab").data("neo-b-info"),i=t.closest(".ni_block").find('.tabs .tab[data-neo-b-info="'+e+'"]');i.length&&i.addClass("has-errors")}))},_setBlockTypeClassErrors(){const t=n()(".ni_block .tab.has-errors");t.each((function(){t.parents(".ni_block.is-collapsed").each((function(){n()(this).find("> .ni_block_topbar .title .blocktype").addClass("has-errors")}))}))},_updateBlockOrder(){const t=[];this.$blocksContainer.find(".ni_block").each(((e,n)=>{const i=this.getBlockByElement(n);t.push(i)})),this._blocks=t,this.trigger("updateBlockOrder"),this.trigger("change",{block:null})},_updateBlockChildren(){for(const t of this._blocks){const e=t.$blocksContainer.children(".ni_block"),n=Math.min(e.length,8),i=[];for(let t=0;t<n;t++)i.push('<div class="ni_block_collapsed-children_child"></div>');t.$collapsedChildrenContainer.html(i.join(""))}},_checkMaxChildren(t){if(!t)return!0;const e=t.getBlockType().getMaxChildBlocks();if(e>0){return this._findChildBlocks(t).length<e}return!0},_updateButtons(){var t;const e=this.getBlocks();this._buttons.updateButtonStates(e),null===(t=this._tempButtons)||void 0===t||t.updateButtonStates(e,this._checkMaxChildren(this._tempButtonsBlock));for(const t of e){var n;t.updateActionsMenu(),null===(n=t.getButtons())||void 0===n||n.updateButtonStates(e,this._checkMaxChildren(t),t),t.toggleShowButtons(!this.atMaxLevels(t.getLevel()))}},_blockBatch(t,e){const n=t.isSelected()?this.getSelectedBlocks():[t];for(const t of n)e(t)},_destroyTempButtons(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t=!o().prefersReducedMotion()&&("boolean"!=typeof t||t),this._tempButtons){const e=this._tempButtons;e.off("newBlock"),t?e.$container.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:-e.$container.outerHeight()},"fast",(t=>e.$container.remove())):e.$container.remove(),this._tempButtons=null,this._tempButtonsBlock=null}},_findPrevBlockOnLevel(t,e){t instanceof y&&(t=this._blocks.indexOf(t));let n=this._blocks[--t],i=Number.MAX_VALUE;for(;n;){const o=n.getLevel();if(o<i){if(o===e)return n;i=o}n=this._blocks[--t]}return!1},_findChildBlocks(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t instanceof y&&(t=this._blocks.indexOf(t)),e="boolean"==typeof e&&e;const n=this._blocks[t];return n?n.getChildren(this._blocks,e):[]},_findParentBlock(t){t instanceof y&&(t=this._blocks.indexOf(t));const e=this._blocks,n=e[t];if(n){const i=n.getLevel();if(i>1){let o=t,s=n;for(;s&&s.getLevel()>=i;)s=e[--o];return s}}return null},_getNextBlockIndex(t){t instanceof y&&(t=this._blocks.indexOf(t));const e=this._findChildBlocks(t,!0),n=e[e.length-1];return(n?this._blocks.indexOf(n):t)+1},_duplicate(t,e){var i;null===(i=this.$form.data("elementEditor"))||void 0===i||i.pause();const s=!o().prefersReducedMotion(),l=n()('<div class="ni_spinner">'.concat(s?'<div class="spinner"></div>':"Loading block","</div>"));e.$container.after(l);let c=!1,r=function(){};s?l.css({opacity:0,marginBottom:-l.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(()=>{c=!0,r()})):(c=!0,r()),a().postActionRequest("neo/input/render-blocks",t,(t=>{if(t.success&&t.blocks.length>0){const n=[];for(const e of t.blocks){const t=y.getNewId(),i=this.getBlockTypeById(e.type),o=new p({id:i.getId(),fieldLayoutId:i.getFieldLayoutId(),name:i.getName(),handle:i.getHandle(),maxBlocks:i.getMaxBlocks(),maxSiblingBlocks:i.getMaxSiblingBlocks(),maxChildBlocks:i.getMaxChildBlocks(),childBlocks:i.getChildBlocks(),topLevel:i.getTopLevel(),tabs:e.tabs}),s=new $({items:o.getChildBlockItems(this.getItems()),maxBlocks:this.getMaxBlocks()}),a=new y({namespace:[...this._templateNs,t],field:this,blockType:o,id:t,level:0|e.level,buttons:s,enabled:!!e.enabled,collapsed:!!e.collapsed,showButtons:!this.atMaxLevels(0|e.level)},!0);n.push(a)}r=()=>{var t;let i=this._getNextBlockIndex(e);for(const t of n)this.addBlock(t,i++,t.getLevel(),!1);if(s){const t=n[0];t.$container.css({opacity:0,marginBottom:l.outerHeight()-t.$container.outerHeight()+10}).velocity({opacity:1,marginBottom:10},"fast",(e=>o().requestAnimationFrame((()=>o().scrollContainerToElement(t.$container)))))}l.remove(),null===(t=this.$form.data("elementEditor"))||void 0===t||t.resume()},c&&r()}}))},"@newBlock"(t){const e=y.getNewId(),n=new y({namespace:[...this._templateNs,e],field:this,blockType:t.blockType,id:e,buttons:new $({items:t.blockType.getChildBlockItems(this.getItems()),maxBlocks:this.getMaxBlocks()}),showButtons:!this.atMaxLevels(t.level)},!0);this.addBlock(n,t.index,t.level)},"@addBlockAbove"(t){this._destroyTempButtons();const e=!o().prefersReducedMotion()&&!1!==t.animate,n=t.block,i=this._blocks.indexOf(n),s=this._findParentBlock(i),a=this.getBlocks(),l=new $({blockTypes:s?[]:this.getBlockTypes(!0),blocks:a,groups:s?[]:this.getGroups(),items:s?s.getBlockType().getChildBlockItems(this.getItems()):null,maxBlocks:this.getMaxBlocks()});n.$container.before(l.$container),l.on("newBlock",(t=>this["@newBlock"]({blockType:t.blockType,index:i,level:n.getLevel()}))),l.initUi(),e&&l.$container.css({opacity:0,marginBottom:-l.$container.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(t=>o().requestAnimationFrame((()=>o().scrollContainerToElement(l.$container))))),this._tempButtons=l,this._tempButtonsBlock=this._findParentBlock(n),this._tempButtons.updateButtonStates(a,this._checkMaxChildren(this._tempButtonsBlock),this._tempButtonsBlock)},"@copyBlock"(t){const e=[];let n=0;const i=this._ownerId;this._blockBatch(t.block,(t=>{if(!(n>0&&-1!==e[e.length-1].indexOf(t))){const i=[];i.push(t,...this._findChildBlocks(t,!0)),e.push(i),n+=i.length}}));const o={field:this._name,blocks:[]};for(const t of e){const e=t[0].getLevel()-1;for(const n of t){const t={type:n.getBlockType().getId(),level:n.getLevel()-e,content:n.getContent(),ownerId:i};n.isEnabled()&&(t.enabled=1),n.isExpanded()||(t.collapsed=1),o.blocks.push(t)}}window.localStorage.setItem("neo:copy",JSON.stringify(o)),this._updateButtons();const s=1===n?"1 block copied":"{n} blocks copied";a().cp.displayNotice(a().t("neo",s,{n}))},"@pasteBlock"(t){const e=t.block,n=e.getLevel(),i=window.localStorage.getItem("neo:copy");if(i){const{blocks:t}=JSON.parse(i);for(const e of t)e.level+=n;l.enter(this._templateNs);const o={namespace:l.toFieldName(),siteId:this._siteId,blocks:t};l.leave(),this._duplicate(o,e)}},"@duplicateBlock"(t){const e=t.block,n=this._blocks.indexOf(e),i=this._findChildBlocks(n,!0),o=this._ownerId,s=t=>({collapsed:0|!t.isExpanded(),content:t.getContent(),enabled:0|t.isEnabled(),level:t.getLevel(),ownerId:o,type:t.getBlockType().getId()});l.enter(this._templateNs);const a={namespace:l.toFieldName(),siteId:this._siteId,blocks:[s(e),...i.map(s)]};l.leave(),this._duplicate(a,e)}});var w;const I=null!==(w=window)&&void 0!==w?w:void 0,E=[];I.Neo={Input:T,inputs:E,createInput(){const t=new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return E.push(t),t}}})();